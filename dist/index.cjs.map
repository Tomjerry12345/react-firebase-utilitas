{"version":3,"file":"index.cjs","sources":["../lib/index.js"],"sourcesContent":["import { initializeApp } from \"firebase/app\";\r\nimport {\r\n  createUserWithEmailAndPassword,\r\n  signInWithEmailAndPassword,\r\n  signOut,\r\n  getAuth,\r\n  deleteUser,\r\n} from \"firebase/auth\";\r\nimport { getStorage, ref, getDownloadURL, uploadBytesResumable } from \"firebase/storage\";\r\nimport {\r\n  getFirestore,\r\n  collection,\r\n  addDoc,\r\n  getDocs,\r\n  query,\r\n  where,\r\n  updateDoc,\r\n  doc,\r\n  deleteDoc,\r\n  setDoc,\r\n  serverTimestamp,\r\n  orderBy,\r\n  limit,\r\n  onSnapshot,\r\n} from \"firebase/firestore\";\r\n\r\nconst FirebaseUtilitas = (config) => {\r\n\r\n  const app = initializeApp(config);\r\n  const auth = getAuth(app);\r\n  const storage = getStorage(app);\r\n  const db = getFirestore(app);\r\n\r\n  const timestamp = () => new Date().getTime()\r\n\r\n  const createUser = async (email, password) =>\r\n    await createUserWithEmailAndPassword(auth, email, password);\r\n\r\n  const deleteUserServices = (col, email, password, id) =>\r\n    new Promise(async (resolve, reject) => {\r\n      await loginWithEmail(email, password);\r\n      auth.onAuthStateChanged(function (user) {\r\n        if (user !== null) {\r\n          deleteUser(user)\r\n            .then(() => {\r\n              // User deleted.\r\n              deletDoc(col, id);\r\n              resolve(true);\r\n            })\r\n            .catch((error) => {\r\n              console.error(error)\r\n              resolve(false);\r\n            });\r\n        }\r\n      });\r\n    });\r\n\r\n  const uploadImage = (file) => {\r\n    return new Promise((resolve, reject) => {\r\n      const storageRef = ref(storage, `images/${file.name}`);\r\n      const uploadTask = uploadBytesResumable(storageRef, file);\r\n\r\n      uploadTask.on(\r\n        \"state_changed\",\r\n        (snapshot) => {\r\n          const progress =\r\n            (snapshot.bytesTransferred / snapshot.totalBytes) * 100;\r\n          console.log(\"Upload is \" + progress + \"% done\");\r\n        },\r\n        (error) => {\r\n          reject(error);\r\n        },\r\n        () => {\r\n          getDownloadURL(uploadTask.snapshot.ref).then((downloadURL) => {\r\n            resolve(downloadURL);\r\n          });\r\n        }\r\n      );\r\n    });\r\n  };\r\n\r\n  const addData = (col, data) =>\r\n    addDoc(collection(db, col), { ...data, timestamp: serverTimestamp() });\r\n\r\n  const addDataSpecifict = (col, data) =>\r\n    addDoc(col, { ...data, timestamp: serverTimestamp() });\r\n\r\n  const sendMessage = (dokter, pasien, data) => {\r\n    const colRef = collection(db, `chat`, dokter, \"message\", pasien, \"message\");\r\n    const colUser = doc(db, `chat`, dokter, \"message\", pasien);\r\n    addDoc(colRef, data);\r\n    setDoc(colUser, { generate: timestamp() });\r\n  };\r\n\r\n  const getMessage = (setMessages, dokter, pasien) => {\r\n    const colRef = collection(db, `chat`, dokter, \"message\", pasien, \"message\");\r\n    const q = query(colRef, orderBy(\"timestamp\"), limit(50));\r\n\r\n    const unsubscribe = onSnapshot(q, (QuerySnapshot) => {\r\n      let messages = [];\r\n      QuerySnapshot.forEach((doc) => {\r\n        messages.push({ ...doc.data(), id: doc.id });\r\n      });\r\n      // messages = messages.sort((a, b) => a.timestamp - b.timestamp);\r\n      setMessages(messages);\r\n    });\r\n\r\n    return unsubscribe;\r\n  };\r\n\r\n  const getGrupMessage = async (dokter) => {\r\n    try {\r\n      // const docRef = doc(db, \"chat\", dokter);\r\n      const colRef = collection(db, `chat`, dokter, \"message\");\r\n\r\n      const docs = await getDocs(colRef);\r\n\r\n      const userGroup = [];\r\n      docs.forEach(async (v) => {\r\n        const id = v.id;\r\n        userGroup.push(id);\r\n      });\r\n\r\n      return userGroup;\r\n    } catch (error) {\r\n      alert(error);\r\n    }\r\n  };\r\n\r\n  const getDataCollection = async (col) => {\r\n    const collection_ref = collection(db, col);\r\n    const docs = await getDocs(collection_ref);\r\n    const data = [];\r\n    docs.forEach((v) => {\r\n      data.push({ ...v.data(), id: v.id });\r\n    });\r\n\r\n    return data;\r\n  };\r\n\r\n  const getNotif = async (col, setData) => {\r\n    const user = await getCurrentUser();\r\n    const collection_ref = collection(db, col);\r\n\r\n    const q = query(\r\n      collection_ref,\r\n      where(\"email\", \"==\", user.email),\r\n      where(\"new\", \"==\", true)\r\n    );\r\n\r\n    const unsubscribe = onSnapshot(q, (querySnapshot) => {\r\n      const newData = [];\r\n      querySnapshot.forEach((doc) => {\r\n        newData.push({ id: doc.id, ...doc.data() });\r\n      });\r\n      console.log(newData);\r\n      // Lakukan sesuatu dengan data newData\r\n    });\r\n  };\r\n\r\n  const getDataSpecifict = async (col) => {\r\n    const collection_ref = col;\r\n    const docs = await getDocs(collection_ref);\r\n    const data = [];\r\n    docs.forEach((v) => {\r\n      data.push({ ...v.data(), id: v.id });\r\n    });\r\n\r\n    return data;\r\n  };\r\n\r\n  const getDataQuery = async (col, key, value) => {\r\n    const collection_ref = collection(db, col);\r\n    const q = query(collection_ref, where(key, \"==\", value));\r\n    const docs = await getDocs(q);\r\n    const data = [];\r\n    docs.forEach((v) => {\r\n      data.push({ ...v.data(), id: v.id });\r\n    });\r\n\r\n    // return data.sort((a, b) => a.timestamp - b.timestamp);\r\n    return data;\r\n  };\r\n\r\n  const getDataQuery2 = async (col, key, value, key1, value1) => {\r\n    const collection_ref = collection(db, col);\r\n    const q = query(\r\n      collection_ref,\r\n      where(key, \"==\", value),\r\n      where(key1, \"==\", value1)\r\n    );\r\n    const docs = await getDocs(q);\r\n    const data = [];\r\n    docs.forEach((v) => {\r\n      data.push({ ...v.data(), id: v.id });\r\n    });\r\n\r\n    // return data.sort((a, b) => a.timestamp - b.timestamp);\r\n    return data;\r\n  };\r\n\r\n  const updateDocX = (col, document, data) =>\r\n    updateDoc(doc(db, col, document), data);\r\n\r\n  const deletDoc = (col, document) => deleteDoc(doc(db, col, document));\r\n\r\n  const loginWithEmail = (email, password) =>\r\n    signInWithEmailAndPassword(auth, email, password);\r\n\r\n  const getCurrentUser = () =>\r\n    new Promise((resolve, reject) => {\r\n      auth.onAuthStateChanged(function (user) {\r\n        if (user) {\r\n          resolve(user);\r\n        } else {\r\n          resolve(null);\r\n        }\r\n      });\r\n    });\r\n\r\n  const onSignOut = async () => await signOut(auth);\r\n\r\n  return {\r\n    createUser,\r\n    deleteUserServices,\r\n    uploadImage,\r\n    addData,\r\n    addDataSpecifict,\r\n    loginWithEmail,\r\n    getDataQuery,\r\n    getDataQuery2,\r\n    getCurrentUser,\r\n    updateDocX,\r\n    deletDoc,\r\n    getDataCollection,\r\n    getNotif,\r\n    getDataSpecifict,\r\n    sendMessage,\r\n    getMessage,\r\n    getGrupMessage,\r\n    onSignOut,\r\n  };\r\n};\r\n\r\nexport default FirebaseUtilitas;"],"names":["config","app","initializeApp","auth","getAuth","storage","getStorage","db","getFirestore","deletDoc","col","document","deleteDoc","doc","loginWithEmail","email","password","signInWithEmailAndPassword","getCurrentUser","Promise","resolve","reject","onAuthStateChanged","user","createUser","createUserWithEmailAndPassword","e","deleteUserServices","id","then","deleteUser","error","console","uploadImage","file","storageRef","ref","name","uploadTask","uploadBytesResumable","on","snapshot","log","bytesTransferred","totalBytes","getDownloadURL","downloadURL","addData","data","addDoc","collection","_extends","timestamp","serverTimestamp","addDataSpecifict","getDataQuery","key","value","collection_ref","q","query","where","getDocs","docs","forEach","v","push","getDataQuery2","key1","value1","updateDocX","updateDoc","getDataCollection","getNotif","setData","onSnapshot","querySnapshot","newData","getDataSpecifict","sendMessage","dokter","pasien","colRef","colUser","setDoc","generate","Date","getTime","getMessage","setMessages","orderBy","limit","QuerySnapshot","messages","getGrupMessage","body","recover","result","userGroup","_catch","alert","onSignOut","signOut"],"mappings":"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"}